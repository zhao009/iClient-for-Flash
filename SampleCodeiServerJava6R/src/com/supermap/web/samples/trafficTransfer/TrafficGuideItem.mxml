<?xml version="1.0" encoding="utf-8"?>
<s:ItemRenderer xmlns:fx="http://ns.adobe.com/mxml/2009"
				xmlns:s="library://ns.adobe.com/flex/spark" 
			    creationComplete="itemrenderer1_creationCompleteHandler(event)"
				xmlns:mx="library://ns.adobe.com/flex/mx">
	<fx:Script>
		<![CDATA[
			import com.supermap.web.iServerJava6R.trafficTransferAnalystServices.TransferLine;
			import com.supermap.web.iServerJava6R.trafficTransferAnalystServices.TransferLines;
			import com.supermap.web.iServerJava6R.trafficTransferAnalystServices.TransferPathParameters;
			import com.supermap.web.iServerJava6R.trafficTransferAnalystServices.TransferPathResult;
			import com.supermap.web.iServerJava6R.trafficTransferAnalystServices.TransferPathService;
			import com.supermap.web.iServerJava6R.trafficTransferAnalystServices.TransferSolution;
			
			import mx.collections.ArrayCollection;
			import mx.controls.Alert;
			import mx.events.FlexEvent;
			import mx.rpc.AsyncResponder;
			
			[Bindable]
			public static var startStopName:String;
			[Bindable]
			public static var endStopName:String;
			[Bindable]
			public static var selectedStartStopID:int;
			[Bindable]
			public static var selectedEndStopID:int;
			[Bindable]
			public static var trafficTransferUrl:String;
			[Bindable]
			public var pathListData:ArrayCollection;
			private var transferLinesForPath:Array = [];
			
			//执行交通换乘路径分析服务
			private function excuteTransferPathService():void
			{
				var transferPathService:TransferPathService = new TransferPathService(trafficTransferUrl);
				var transferPathParameters:TransferPathParameters = new TransferPathParameters();
				transferPathParameters.transferLines = transferLinesForPath;
				
				transferPathParameters.points = [selectedStartStopID, selectedEndStopID];
				
				transferPathService.processAsync(transferPathParameters, new AsyncResponder(this.displayAnalystResult, 
					function (object:Object, mark:Object = null):void
					{
						Alert.show("公交换乘分析失败！");
					}, null));
			}
			
			private function displayAnalystResult(queryResult:TransferPathResult, mark:Object = null):void
			{
				pathListData = new ArrayCollection(queryResult.transferGuide.items);
			}
			
			protected function itemrenderer1_creationCompleteHandler(event:Event):void
			{
				var linesItems:Array = (data as TransferSolution).linesItems;
				var tempLinesName:String = "";
				for(var i:int = 0; i < linesItems.length; i++)
				{
					if(i > 0)
						tempLinesName += " —— ";
					var tempLine:String = "";
					var transferLines:TransferLines = linesItems[i];
					
					transferLinesForPath.push(transferLines.lineItems[0]);
					
					for(var j:int = 0; j < transferLines.lineItems.length; j++)
					{
						if(j > 0)
							tempLine += "/";
						var transferLine:TransferLine = transferLines.lineItems[j];
						tempLine  += transferLine.lineName;
					}
					
					tempLinesName += tempLine;
				}
				transferLineName.text = tempLinesName;
				
				this.excuteTransferPathService();
			}
			
			// 点击换乘路线面板，地图上高亮其对应的路线
			protected function itemrenderer1_clickHandler(event:MouseEvent):void
			{
				this.parentApplication.dispatchEvent(new TrafficGuideItemEvent(TrafficGuideItemEvent.GUIDE_ITEM_CHANGE, pathListData.toArray()));
			}
			
		]]>
	</fx:Script>

	<s:Rect width="100%"
			height="100%">
		<s:fill>
			<s:SolidColor color="#e5f0ff"/>
		</s:fill>
	</s:Rect>
	<s:Rect width="100%"
			height="8">
		<s:fill>
			<s:SolidColor color="#ffffff"/>
		</s:fill>
	</s:Rect>
	
	<s:VGroup width="100%"
			  height="100%"
			  left="3"
			  right="3"
			  top="3"
			  bottom="3" horizontalAlign="center">
		
		<s:Label id="transferLineName"
					 width="100%"
					 height="30"
					 fontSize="15"
					 text=" "
					 paddingTop="10"
					 paddingLeft="5"
					 verticalCenter="0"
					 click="itemrenderer1_clickHandler(event)"
					 backgroundColor="#b2d2ff"/>
		
			<s:HGroup id="startGroup"
				  width="100%"
				  height="50%"
				  verticalAlign="middle">
			<mx:Image source="../assets/path/start.png"/>
			<s:Label id="startInfo"
						 height="30"
						 text="{startStopName}"
						 fontSize="15"
						 paddingTop="8"
						 backgroundColor="#b2d2ff"/>
		</s:HGroup>
		<s:List id="pathList" itemRenderer="com.supermap.web.samples.trafficTransfer.PathListRenderer"
				contentBackgroundColor="0xffffff" width="100%" dataProvider="{pathListData}" height="{pathListData.length * 32}"/>
		<s:HGroup id="endGroup"
				  width="100%"
				  height="50%"
				  verticalAlign="middle">
			<mx:Image source="../assets/path/end.png"/>
			<s:Label id="endInfo"
						 height="30"
						 text="{endStopName}"
						 fontSize="15"
						 right="0"
						 paddingTop="8"
						 backgroundColor="#b2d2ff"/>
		</s:HGroup>
	</s:VGroup>
</s:ItemRenderer>
